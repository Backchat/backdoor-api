<html>
<head>
<script src="jquery.js"></script>
<script>
$(function(){

function updateLoginStatus() {
    FB.getLoginStatus(function(response) {
        if (response.status === 'connected') {
            $('.facebook-login').hide();
            $('.facebook-logout').show();
            $('.facebook-token').val(response.authResponse.accessToken)
        } else {
            $('.facebook-login').show();
            $('.facebook-logout').hide();
            $('.facebook-token').val('');
        };
        $('.facebook-status').text(response.status)
    });
}


window.fbAsyncInit = function() {
    FB.init({
        appId      : '122753474571987',
        channelUrl : '//capricalabs.com:7564/channel.html',
        status     : true,
        cookie     : true,
        xfbml      : true
    });

    updateLoginStatus();
};

$('.facebook-login').click(function(ev){
    ev.preventDefault();
    FB.login(function(response) {
        if (response.authResponse) {
            updateLoginStatus();
        }
    });
});

$('.facebook-logout').click(function(ev){
    ev.preventDefault();
    FB.logout(function(response) {
        updateLoginStatus();
    });
});

$('.request-submit').click(function(ev){
    ev.preventDefault();
    var method = $('.request-method option:selected').val().split(';');
    var id = $('.request-id').val();
    var url = ('/' + method[1].replace('ID', id));

    $.ajax({
        type: method[0],
        url: url,
        data: eval("(" + $('.request-params').val() + ")"),
        dataType: 'json',
        error: function(xhr, stat, err) {
            $('.response').val(stat + ": " + err);
        },
        success: function(data, stat, xhr) {
            $('.response').val(JSON.stringify(data, null, " "));
            if (url == '/users/login') {
                $('.session-token').val(data['response']);
            }
        }
    });
});

$('.request-method').change(function(){
    var params = {
        "POST;users/login": {
            'access_token': $('.facebook-token').val(),
            'data': { 
                'id': '100004777423660',
                'first_name': 'Alice',
                'last_name': 'Kramden',
                'email': 'alice@example.com'
            }
        },
        "GET;topics": { 'page': 1 },
        "POST;topics": { 'title': 'Hello World!' },
        "PUT;topics/ID": { 'title': 'New title!' },
        "POST;messages": { 'topic_id': 3, 'content': 'Content' }
    };

    var val = $('.request-method option:selected').val();

    var myparams = params[val] || {}
    if (val != 'POST;users/login') {
        myparams['session_token'] = $('.session-token').val();
    }

    $('.request-params').val(JSON.stringify(myparams, null, " "));
    $('.request-id-wrap').toggle(val.indexOf('ID') != -1);
});

(function(d){
   var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
   if (d.getElementById(id)) {return;}
   js = d.createElement('script'); js.id = id; js.async = true;
   js.src = "//connect.facebook.net/en_US/all.js";
   ref.parentNode.insertBefore(js, ref);
}(document));

});
</script>
<style>
body{font-family:arial;font-size:12px;}
h1{font-size:18px;}
label{display:inline-block;width:200px;}
input,select,textarea{border:1px solid gray;width:400px;}
textarea{vertical-align:top;height:160px;}
.response{height:250px;}
.wrap{width:620px;}
.request-id-wrap{display:none;}
</style>
</head>
<body>
<h1>Youtell-API panel</h1>
<div id="fb-root"></div>

<div class="wrap">
<p>
    <label>Facebook Status:</label>
    <span class="facebook-status"></span>
    <a class="facebook-login" href="#">log in</a>
    <a class="facebook-logout" href="#">log out</a>
</p>
<p>
    <label>Access Token:</label>
    <input class="facebook-token" />
</p>
<p>
    <label>Session Token:</label>
    <input class="session-token" />
</p>
<p>
    <label>Method:</label>
    <select class="request-method">
        <option value="">Select method</option>
        <option value="POST;users/login">Log in</option>
        <option value="POST;users/logout">Log out</option>
        <option value="POST;topics">Create topic</option>
        <option value="GET;topics">Index topics</option>
        <option value="GET;topics/ID">Get topic</option>
        <option value="PUT;topics/ID">Update topic</option>
        <option value="DELETE;topics/ID">Delete topic</option>
        <option value="POST;messages">Create message</option>
        <option value="GET;messages/ID/clues">Get clues</option>
        <option value="POST;messages/ID/clues">Request a clue</option>
    </select>
</p>
<p class="request-id-wrap">
    <label>Object ID:</label>
    <input class="request-id" />
</p>
<p>
    <label>Additional parameters (JSON):</label>
    <textarea class="request-params"></textarea>
</p>

<p style="text-align:center;">
    <a class="request-submit" href="#">Submit request</a>
</p>

<p>
    <label>Response:</label>
    <textarea class="response"></textarea>
</p>
</div>

</body>
</html>
